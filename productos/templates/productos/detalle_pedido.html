{% extends 'core/base.html' %}
{% load static %}

{% block title %}Detalle del Pedido{% endblock %}
{% block content %}
<div class="container my-5">
    <h1 class="mb-4 text-center">Detalle del Pedido #{{ pedido.id }}</h1>
    <div class="mb-3">
        <strong>Estado:</strong> <span class="badge bg-info">{{ pedido.estado }}</span>
        <strong>Fecha:</strong> {{ pedido.fecha_creacion|date:"d M Y" }}<br>
        <strong>Total:</strong> ${{ pedido.total_pedido|floatformat:2 }}
    </div>
    <div class="mb-3">
        <strong>Dirección:</strong> {{ pedido.direccion }}<br>
        <strong>Ciudad:</strong> {{ pedido.ciudad }}
    </div>
    <table class="table table-hover table-striped">
        <thead>
            <tr>
                <th>Producto</th>
                <th>Cantidad</th>
                <th>Precio Unitario</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in pedido_items %}
            <tr>
                <td>{{ item.producto.nombre }}</td>
                <td>{{ item.cantidad }}</td>
                <td>${{ item.precio_unitario|floatformat:2 }}</td>
                <td>${{ item.cantidad|floatformat:0|add:item.precio_unitario|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="mt-3">
        <strong>Subtotal:</strong> ${{ pedido.total_pedido|floatformat:2 }}<br>
        <strong>IVA (19%):</strong> ${{ iva|floatformat:2 }}<br>
        <strong>Total con IVA:</strong> ${{ total_con_iva|floatformat:2 }}
    </div>
    {% if puede_modificar %}
    <div class="mt-4">
        <a href="{% url 'productos:modificar_pedido' pedido.id %}" class="btn btn-warning me-2">Modificar Pedido</a>
        <a href="{% url 'productos:cancelar_pedido' pedido.id %}" class="btn btn-danger me-2" onclick="return confirm('¿Seguro que deseas cancelar este pedido?');">Cancelar Pedido</a>
        <a href="{% url 'productos:mis_pedidos' %}" class="btn btn-secondary">Volver a Mis Pedidos</a>
    </div>
    {% endif %}
</div>
{% endblock %}
