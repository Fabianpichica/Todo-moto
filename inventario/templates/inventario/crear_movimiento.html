{% extends 'dashboard_admin/dashboard_base.html' %}
{% load static %}

{% block title %}Nuevo Movimiento de Inventario{% endblock %}

{% block dashboard_content %}
<style>
    /* Estilos para el título y contenedor */
    .content-subtitle {
        color: #343a40;
        font-weight: 600;
        margin-bottom: 20px;
    }
    
    .card {
        border: none;
        border-radius: 8px;
    }

    .shadow-sm {
        box-shadow: 0 .125rem .25rem rgba(0,0,0,.075) !important;
    }
    
    /* Estilos para los formularios */
    .form-label {
        font-weight: 500;
        color: #495057;
    }

    .form-control,
    .form-select {
        border-radius: 5px;
        border-color: #ced4da;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }

    .form-control:focus,
    .form-select:focus {
        border-color: #80bdff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    /* Estilos para los botones */
    .btn-primary-custom {
        background-color: #343a40;
        color: #ffffff;
        border: 1px solid #343a40;
        padding: 8px 15px;
        border-radius: 5px;
        text-decoration: none;
        transition: background-color 0.3s ease;
    }

    .btn-primary-custom:hover {
        background-color: #212529;
    }
    
    .btn-secondary-custom {
        background-color: #6c757d;
        color: #ffffff;
        border: 1px solid #6c757d;
        padding: 8px 15px;
        border-radius: 5px;
        text-decoration: none;
        transition: background-color 0.3s ease;
    }

    .btn-secondary-custom:hover {
        background-color: #5a6268;
    }

</style>
    
<div class="container-fluid-custom py-4">
    <h2 class="content-subtitle">Registrar Nuevo Movimiento</h2>

    <div class="card shadow-sm mb-4 p-4">
        <div class="card-body">
            <form method="post" action="{% url 'inventario:crear_movimiento' %}">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="id_producto" class="form-label">Producto</label>
                    <select class="form-select" id="id_producto" name="producto" required>
                        <option value="">Selecciona un producto...</option>
                        {% for producto in productos %}
                            <option value="{{ producto.id }}">{{ producto.nombre }} (Stock: {{ producto.stock }})</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label for="id_tipo_movimiento" class="form-label">Tipo de Movimiento</label>
                    <select class="form-select" id="id_tipo_movimiento" name="tipo_movimiento" required>
                        <option value="">Selecciona el tipo...</option>
                        <option value="Entrada">Entrada</option>
                        <option value="Salida">Salida</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="id_motivo" class="form-label">Motivo</label>
                    <select class="form-select" id="id_motivo" name="motivo" required>
                        <option value="">Selecciona el motivo...</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="id_cantidad" class="form-label">Cantidad</label>
                    <input type="number" class="form-control" id="id_cantidad" name="cantidad" min="1" required>
                </div>
                
                <div class="mb-3">
                    <label for="id_descripcion" class="form-label">Descripción (opcional)</label>
                    <textarea class="form-control" id="id_descripcion" name="descripcion" rows="3"></textarea>
                </div>

                <button type="submit" class="btn-primary-custom">
                    <i class="fas fa-save me-1"></i> Guardar Movimiento
                </button>
                <a href="{% url 'inventario:historial_movimientos' %}" class="btn-secondary-custom">
                    <i class="fas fa-arrow-left me-1"></i> Cancelar
                </a>
            </form>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const tipoMovimientoSelect = document.getElementById('id_tipo_movimiento');
            const motivoSelect = document.getElementById('id_motivo');

            // Los motivos de entrada y salida están aquí para ser usados por el JS
            const motivosEntrada = ['Compra a proveedor', 'Devolución de cliente'];
            const motivosSalida = ['Novedad (daño, pérdida)', 'Venta'];

            function updateMotivos() {
                motivoSelect.innerHTML = '<option value="">Selecciona el motivo...</option>';
                const tipo = tipoMovimientoSelect.value;
                let motivos = [];

                if (tipo === 'Entrada') {
                    motivos = motivosEntrada;
                } else if (tipo === 'Salida') {
                    motivos = motivosSalida;
                }

                motivos.forEach(motivo => {
                    const option = document.createElement('option');
                    option.value = motivo;
                    option.textContent = motivo;
                    motivoSelect.appendChild(option);
                });
            }

            tipoMovimientoSelect.addEventListener('change', updateMotivos);
            // Ejecutar al cargar para que muestre el valor por defecto si lo hubiera
            updateMotivos(); 
        });
    </script>
</div>
{% endblock %}
